<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerador da Sho - Cupons da Sho</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body { background-color: #121212; color: white; font-family: 'Segoe UI', sans-serif; text-align: center; padding: 20px; margin: 0; }
        .container { max-width: 450px; margin: auto; background: #1e1e1e; padding: 25px; border-radius: 25px; }
        .logo { width: 120px; border-radius: 20px; margin-bottom: 20px; }
        
        input { width: 100%; padding: 15px; border-radius: 12px; border: 1px solid #333; margin: 10px 0; background: #2c2c2c; color: white; box-sizing: border-box; }
        .btn-gerar { background: linear-gradient(45deg, #ff4d2d, #ff6a00); color: white; padding: 15px; width: 100%; border: none; border-radius: 12px; font-weight: bold; cursor: pointer; font-size: 16px; margin-top: 10px; }
        
        /* BOX DE RESULTADO */
        .resultado-box { margin-top: 25px; background: #2c2c2c; padding: 20px; border-radius: 15px; border-left: 5px solid #4caf50; text-align: left; }
        .link-gerado { color: #ff4d2d; font-size: 14px; word-break: break-all; text-decoration: none; display: block; margin-bottom: 20px; }
        .botoes-acao { display: flex; gap: 10px; }
        .btn-acao { flex: 1; padding: 12px; border-radius: 10px; font-weight: bold; cursor: pointer; text-decoration: none; text-align: center; font-size: 13px; }
        .btn-shopee { background: #ff4d2d; color: white; }
        .btn-copiar { background: #3d3d3d; color: white; }

        /* REDES SOCIAIS */
        .btn-social { display: flex; align-items: center; justify-content: center; gap: 10px; padding: 12px; border-radius: 15px; text-decoration: none; font-weight: bold; margin-top: 10px; }
        .btn-tg { background: #0088cc; color: white; }
        .btn-wa { background: #25d366; color: white; }

        /* HIST√ìRICO COM FOTO REAL */
        .recent-container { margin-top: 40px; text-align: left; border-top: 1px solid #333; padding-top: 20px; }
        .recent-title { color: #ff4d2d; font-size: 13px; font-weight: bold; margin-bottom: 15px; text-transform: uppercase; }
        .recent-card { background: white; border-radius: 15px; padding: 12px; display: flex; align-items: center; gap: 12px; margin-bottom: 12px; color: #333; }
        .recent-img { width: 75px; height: 75px; border-radius: 10px; object-fit: cover; background: #f9f9f9; }
        .recent-info { flex: 1; overflow: hidden; }
        .recent-info h4 { font-size: 12px; margin: 0 0 8px 0; color: #222; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; line-height: 1.3; }
        .recent-buttons { display: flex; gap: 8px; }
        .btn-card { flex: 1; padding: 7px; border-radius: 8px; font-size: 10px; font-weight: bold; text-align: center; text-decoration: none; }
        .btn-open { background: #fce4ec; color: #d81b60; }
        .btn-coupon { background: #f0f0f0; color: #666; }
    </style>
</head>
<body>
    <div class="container">
        <img src="/static/logo.png" class="logo">
        <h2>Gerador da Sho</h2>
        <p style="color:#888; font-size:13px;">Transforme produtos em ofertas exclusivas üß°</p>
        
        <form method="POST">
            <input type="text" name="link_usuario" placeholder="Cole o link do produto aqui..." required>
            <button type="submit" class="btn-gerar">GERAR LINK COM DESCONTO ‚ö°</button>
        </form>

        {% if res %}
        <div class="resultado-box">
            <span style="color:#4caf50; font-size:12px; font-weight:bold;">‚úÖ Link gerado com sucesso:</span>
            <a href="{{ res.link }}" target="_blank" class="link-gerado" id="linkFinal">{{ res.link }}</a>
            <div class="botoes-acao">
                <a href="{{ res.link }}" target="_blank" class="btn-acao btn-shopee">ABRIR NA SHOPEE üõçÔ∏è</a>
                <button onclick="copiarTexto()" class="btn-acao btn-copiar">COPIAR LINK</button>
            </div>
        </div>
        {% endif %}

        <div style="margin-top:30px;">
            <a href="https://t.me/seugrupo" class="btn-social btn-tg"><i class="fab fa-telegram"></i> Grupo no Telegram</a>
            <a href="https://wa.me/seugrupo" class="btn-social btn-wa"><i class="fab fa-whatsapp"></i> Grupo no WhatsApp</a>
        </div>

        <div class="recent-container">
            <h3 class="recent-title"><i class="fas fa-history"></i> LINKS GERADOS RECENTEMENTE</h3>
            <div id="recent-list"></div>
        </div>
    </div>

    <script>
        function copiarTexto() {
            const link = document.getElementById('linkFinal').innerText;
            navigator.clipboard.writeText(link).then(() => alert("Link copiado!"));
        }

        const KEY = 'shopee_history_v3';

        function save(link, title, img) {
            let history = JSON.parse(localStorage.getItem(KEY) || "[]");
            history = history.filter(item => item.link !== link);
            // SALVA A FOTO E O T√çTULO QUE VIERAM DO PYTHON
            history.unshift({ link, title, img: img || '/static/logo.png' });
            localStorage.setItem(KEY, JSON.stringify(history.slice(0, 6)));
            render();
        }

        function render() {
            const list = document.getElementById('recent-list');
            const history = JSON.parse(localStorage.getItem(KEY) || "[]");
            list.innerHTML = history.map(item => `
                <div class="recent-card">
                    <img src="${item.img}" class="recent-img" onerror="this.src='/static/logo.png'">
                    <div class="recent-info">
                        <h4>${item.title}</h4>
                        <div class="recent-buttons">
                            <a href="${item.link}" target="_blank" class="btn-card btn-open">Abrir produto</a>
                            <a href="https://s.shopee.com.br/5L6Pa194W6" class="btn-card btn-coupon">Resgate mais cupons</a>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        {% if res %}
            save("{{ res.link }}", "{{ res.titulo }}", "{{ res.foto }}");
        {% else %}
            render();
        {% endif %}
    </script>
</body>
</html>
