<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerador da Sho - Cupons da Sho</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-icons/6.0.0/css/all.min.css">
    <style>
        /* Estilos do seu site laranja e preto aqui */
        body { background-color: #121212; color: white; font-family: sans-serif; text-align: center; padding: 20px; }
        .container { max-width: 500px; margin: auto; background: #1e1e1e; padding: 20px; border-radius: 20px; }
        .logo { width: 100px; border-radius: 20px; margin-bottom: 15px; }
        input { width: 90%; padding: 12px; border-radius: 10px; border: none; margin: 10px 0; background: #2c2c2c; color: white; }
        .btn-gerar { background: #ff4d2d; color: white; padding: 12px; width: 95%; border: none; border-radius: 10px; font-weight: bold; cursor: pointer; }
        
        /* Estilo dos Links Recentes igual ao seu print */
        .recent-container { margin-top: 30px; text-align: left; }
        .recent-title { color: #ff4d2d; font-size: 14px; font-weight: bold; margin-bottom: 15px; text-transform: uppercase; }
        .recent-card { 
            background: white; border-radius: 15px; padding: 12px; display: flex; align-items: center; gap: 12px; 
            margin-bottom: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.3); color: #333;
        }
        .recent-img { width: 70px; height: 70px; border-radius: 10px; object-fit: cover; }
        .recent-info { flex: 1; }
        .recent-info h4 { font-size: 13px; margin: 0 0 8px 0; color: #444; height: 34px; overflow: hidden; }
        .recent-buttons { display: flex; gap: 8px; }
        .btn-card { flex: 1; padding: 8px; border-radius: 8px; font-size: 11px; font-weight: bold; text-align: center; text-decoration: none; }
        .btn-open { background: #fce4ec; color: #d81b60; }
        .btn-coupon { background: #f0f0f0; color: #666; }
    </style>
</head>
<body>
    <div class="container">
        <img src="/static/logo.png" class="logo">
        <h2>Gerador da Sho</h2>
        <form method="POST">
            <input type="text" name="link_usuario" placeholder="Cole o link do seu produto aqui..." required>
            <button type="submit" class="btn-gerar">GERAR LINK COM DESCONTO ⚡</button>
        </form>

        {% if link_novo %}
        <div style="margin-top:20px; background:#2c2c2c; padding:15px; border-radius:15px;">
            <p style="color:#4caf50;">✅ Link gerado com sucesso!</p>
            <a href="{{ link_novo }}" target="_blank" style="color:#ff4d2d; word-break:break-all;">{{ link_novo }}</a>
        </div>
        {% endif %}

        <div class="recent-container">
            <h3 class="recent-title"><i class="fas fa-history"></i> LINKS GERADOS RECENTEMENTE</h3>
            <div id="recent-list"></div>
        </div>
    </div>

    <script>
        const RECENT_KEY = 'shopee_history';

        function saveHistory(link, title, img) {
            let history = JSON.parse(localStorage.getItem(RECENT_KEY) || "[]");
            // Evita duplicados e salva no início
            history = history.filter(item => item.link !== link);
            history.unshift({ link, title, img });
            localStorage.setItem(RECENT_KEY, JSON.stringify(history.slice(0, 6)));
            renderHistory();
        }

        function renderHistory() {
            const list = document.getElementById('recent-list');
            const history = JSON.parse(localStorage.getItem(RECENT_KEY) || "[]");
            list.innerHTML = history.map(item => `
                <div class="recent-card">
                    <img src="${item.img}" class="recent-img">
                    <div class="recent-info">
                        <h4>${item.title}</h4>
                        <div class="recent-buttons">
                            <a href="${item.link}" target="_blank" class="btn-card btn-open">Abrir produto</a>
                            <a href="https://s.shopee.com.br/5L6Pa194W6" class="btn-card btn-coupon">Resgate mais cupons</a>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Se o servidor enviou um novo link, salva no histórico do celular
        {% if link_novo %}
            saveHistory("{{ link_novo }}", "{{ titulo }}", "{{ foto }}");
        {% else %}
            renderHistory();
        {% endif %}
    </script>
</body>
</html>
